{{- $jsFiles := resources.Match "js/**.js" -}}

{{- if $jsFiles -}}
  {{- $jsBundle := $jsFiles | resources.Concat "js/bundle.js" -}}

  {{- $opts := dict
    "minify" (not hugo.IsDevelopment)
    "sourceMap" (cond hugo.IsDevelopment "external" "")
    "targetPath" "js/bundle.js"
    "format" "cjs"
  -}}

  {{- with $jsBundle | js.Build $opts -}}
    {{- if hugo.IsDevelopment -}}
      <script defer src="{{- .RelPermalink -}}"></script>
    {{- else -}}
      {{- with . | fingerprint -}}
        <script
          defer
          crossorigin="anonymous"
          integrity="{{- .Data.Integrity -}}"
          src="{{- .RelPermalink -}}"
        ></script>
      {{- end -}}
    {{- end -}}
  {{- end -}}
{{- end -}}
